## Добро пожаловать в автосалон Жизнь на колёсах
«Жизнь на колёсах» — прославившаяся сеть салонов легковых автомобилей — стремительно набирает обороты. 

Сеть предоставляет широкий выбор машин от экономкласса до люксовых спорткаров и обслуживает всю страну.
Однако их быстрый рост привел к непредвиденным трудностям: 
с каждым новым салоном становится все сложнее управлять огромным объёмом данных о продажах, 
поставках, запасах и клиентах. Вся эта информация сейчас хранится в сыром, 
неструктурированном виде, что сильно затрудняет работу.

Ваша задача — нормализовать и структурировать существующие сырые данные, а потом написать несколько 
запросов для получения информации из БД. 

Для этого перенесите сырые данные в **PostgreSQL**. 

Вы можете выполнить работу в любом удобном для вас клиенте. 
Результатом станет набор **SQL**-команд, объединённых в единый скрипт. 
Вы будете работать с данными по продажам автомобилей с 2015 по 2023 год.
-----------------------------------------------------------

### Требования к решению
Создайте .sql файл, и положите его в директорию `src` (её тоже создайте)
В файле должны быть:
 - Запросы на создание таблиц и схем. 
 - Запросы на заполнение таблиц данными. 
 - Запросы на аналитику в порядке их выполнения. 
 - Команда COPY для заполнения таблицы с сырыми данными из csv-файла.  
Запросы разделите с помощью ‘;’.
Весь SQL-скрипт должен выполняться без ошибок.

-----------------------------------------------------------
### Описание исходных данных

`id` - id покупки. id из csv-файла переносится только в таблицу с сырыми данными. В нормализованных таблицах используется автоинкремент.
`auto` - Бренд, название машины и цвет. Бренд и цвет всегда состоят из одного слова, название машины может состоять из одного или нескольких слов. Бренд и название машины всегда разделены пробелом, цвет отделён запятой.
`gasoline_consumption` - Потребление бензина, литр на 100 км (средний по модификациям). Салон продаёт только легковые автомобили, поэтому число не может быть трёхзначным. Для электромобилей это значение отсутствует. 
`price` - Цена в $ с учётом скидки. Несмотря на то, что в салоне продаются не только экономкласса, цена не может быть больше семизначной суммы
`date` - Дата покупки
`person` - ФИО покупателя
`phone` - Телефон покупателя. Для упрощения считаем, что телефон пользователя не меняются.
`discount` - Размер скидки в процентах
`brand_origin` - Страна происхождения бренда
-----------------------------------------------------------
### Задания
_Названия полей в таблицах должны быть на английском языке — помните о принципах наименования объектов. 
Правильные названия полей облегчают поддержку вашей БД и повышают читабельность кода._
#### Подготовка
1) Создайте БД `life_on_wheels`
2) Создайте схему `raw_data` и таблицу `sales` для загрузки сырых данных в этой схеме. Начиная с этого пункта (включительно) все SQL-команды должны быть в итоговом скрипте.
3) Проанализируйте исходный **csv**-файл [cars.csv](cars.csv) в репозитории
4) Заполните таблицу sales данными, используя команду `COPY` 
5) Проанализируйте сырые данные. Подумайте:
   - какие данные повторяются и их стоит вынести в отдельные таблицы;
   - какие типы данных должны быть у каждого поля;
   - на какие поля стоит добавить ограничения (`CONSTRAINTS`);
   - какие поля могут содержать `NULL`, а где нужно добавить ограничение `NOT NULL`.
6) Создайте схему `car_shop`, а в ней cоздайте нормализованные таблицы (до третьей нормальной формы). Подумайте, какие поля будут выступать первичными ключами, а какие внешними. У всех первичных ключей должен быть автоинкремент.
7) Выберите наиболее подходящий формат данных для каждой колонки. Используя комментарий (-- comment), для каждого поля напишите, почему вы выбрали тот или иной тип данных
8) Заполните все таблицы данными, c помощью команд INSERT INTO … SELECT …. Чтобы разбить столбец с маркой, моделью машины и её цветом, можно использовать разные способы — выбирайте любой, удобный для себя.

### Аналитические скрипты
-----------------------------------------------------------
#### Задание №1
Напишите запрос, который выведет процент моделей машин, у которых нет параметра gasoline_consumption.

| nulls_percentage_gasoline_consumption |
|---------------------------------------|
|Число|

-----------------------------------------------------------
#### Задание №2
Напишите запрос, который покажет название бренда и среднюю цену его автомобилей в разбивке по всем годам с учётом скидки. Итоговый результат отсортируйте по названию бренда и году в восходящем порядке. 
Среднюю цену округлите до второго знака после запятой.
Формат итоговой таблицы:

| brand_name | year | price_avg    |
|------------|------|--------------|
| Audi       | 2015 | Средняя цена |
| Audi       | ...  | Средняя цена |
| Audi       | 2023 | Средняя цена |
| BMW        | 2015 | Средняя цена |
| BMW        | ...  | Средняя цена |
| BMW        | 2023 | Средняя цена |
| Hyundai    | 2015 | Средняя цена |
| Hyundai    | ...  | Средняя цена |
| Hyundai    | 2023 | Средняя цена |

-----------------------------------------------------------
#### Задание №3
Посчитайте среднюю цену всех автомобилей с разбивкой по месяцам в 2022 году с учётом скидки. Результат отсортируйте по месяцам в восходящем порядке. 
Среднюю цену округлите до второго знака после запятой.

Формат итоговой таблицы:

| month   | year | price_avg    |
|---------|------|--------------|
| 1       | 2022 | Средняя цена |
| 2       | 2022 | Средняя цена |
| 3       | 2022 | Средняя цена |
| ...     | 2022 | Средняя цена |
| 12      | 2022 | Средняя цена |

-----------------------------------------------------------
#### Задание №4
Используя функцию `STRING_AGG`, напишите запрос, который выведет список купленных машин у каждого пользователя через запятую. 
Пользователь может купить две одинаковые машины — это нормально. 
Название машины покажите полное, с названием бренда — например: Tesla Model 3.
Отсортируйте по имени пользователя в восходящем порядке. 
Сортировка внутри самой строки с машинами не нужна.

Формат итоговой таблицы:

| person           | cars                 |
|------------------|----------------------|
| Alexander Kozlov | Lada Vesta           |
| John Doe         | Audi A3, Lada Samara |
| Ivan Petrov      | Audi S3              |

-----------------------------------------------------------
#### Задание №5

Напишите запрос, который вернёт самую большую и самую маленькую цену продажи 
автомобиля с разбивкой по стране без учёта скидки. 
Цена в колонке `price` дана с учётом скидки.

Формат итоговой таблицы:

| brand_origin | price_max         | price_min        |
|--------------|-------------------|------------------|
| USA          | Максимальная_цена | Минимальная_цена |
| Germany      | Максимальная_цена | Минимальная_цена |
| South Korea  | Максимальная_цена | Минимальная_цена |
| Russia       | Максимальная_цена | Минимальная_цена |

-----------------------------------------------------------
#### Задание №6
Напишите запрос, который покажет количество всех пользователей из США. Это пользователи, у которых номер телефона начинается на +1.

Формат итоговой таблицы:

| persons_from_usa_count |
|------------------------|
| число                  |

